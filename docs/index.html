<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Redux Thunk | redux-thunk</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Redux Thunk" />
<meta property="og:locale" content="ja" />
<meta property="og:image" content="https://avatars.githubusercontent.com/u/82270353?s=400&v=4" />
<link rel="canonical" href="https://japanese-document.github.io/redux-thunk/" />
<meta property="og:url" content="https://japanese-document.github.io/redux-thunk/" />
<meta property="og:site_name" content="redux-thunk" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Redux Thunk" />
<script type="application/ld+json">
{"headline":"Redux Thunk","url":"https://japanese-document.github.io/redux-thunk/","@type":"WebSite","name":"redux-thunk","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/redux-thunk/assets/css/style.css?v=850aa50004e1b206f782b341b367f11557e919aa">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">

      <h1 id="redux-thunk">Redux Thunk</h1>

<p>Reduxã®Thunk <a href="https://redux.js.org/advanced/middleware">middleware</a></p>

<h2 id="2xã¸updateã™ã‚‹éš›ã®æ³¨æ„ç‚¹">2.xã¸Updateã™ã‚‹éš›ã®æ³¨æ„ç‚¹</h2>

<p>ä»Šã‚ã‚‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯React Thunk 1.xã‚’å¯¾è±¡ã«ã—ã¦ã„ã‚‹ç‰©ãŒã»ã¨ã‚“ã©ã§ã™ã€‚React Thunk 2.xã§ãã‚Œã‚’è©¦ã™ã¨å•é¡ŒãŒç”Ÿã˜ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚<strong>CommonJSã§Redux Thunk 2.xã‚’
<a href="https://github.com/reduxjs/redux-thunk/releases/tag/v2.0.0">ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹æ™‚ã¯<code class="language-plaintext highlighter-rouge">.default</code>ã‚’ä»˜ã‘ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚</a></strong></p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- const ReduxThunk = require('redux-thunk')
</span><span class="gi">+ const ReduxThunk = require('redux-thunk').default
</span></code></pre></div></div>

<p>ES modulesã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€å¤‰æ›´ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">ReduxThunk</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux-thunk</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// å¤‰æ›´ãªã— ğŸ˜€</span>
</code></pre></div></div>

<p>2.xã‹ã‚‰<a href="https://unpkg.com/redux-thunk/dist/redux-thunk.min.js">UMD build</a>ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">ReduxThunk</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ReduxThunk</span><span class="p">.</span><span class="k">default</span><span class="p">;</span>
</code></pre></div></div>

<p>è¦‹ã¦ã®é€šã‚Šã€ã“ã‚Œã‚‚æœ«å°¾ã«<code class="language-plaintext highlighter-rouge">.default</code>ãŒå¿…è¦ã§ã™ã€‚</p>

<h2 id="ãªãœredux-thunkãŒå¿…è¦ãªã®ã‹">ãªãœRedux ThunkãŒå¿…è¦ãªã®ã‹ï¼Ÿ</h2>

<p>ç´ ã®Redux storeã¯actionã‚’dispatchã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹ã‚·ãƒ³ãƒ—ãƒ«ã§åŒæœŸçš„ãªæ›´æ–°ã—ã‹ã§ãã¾ã›ã‚“ã€‚middlewareã¯storeã®å¯èƒ½æ€§ã‚’æ‹¡å¼µã—ã¾ã™ã€‚ãã—ã¦ã€dispatchã¨storeã®é–“ã§éåŒæœŸãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚</p>

<p><a href="https://github.com/reduxjs/redux-thunk">Redux Thunk</a>ã¯ã€storeã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹è¤‡é›‘ãªåŒæœŸãƒ­ã‚¸ãƒƒã‚¯ã‚„å˜ç´”ãªAjaxãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚ˆã†ãªéåŒæœŸãƒ­ã‚¸ãƒƒã‚¯ãŒå«ã¾ã‚Œã‚‹åŸºæœ¬çš„ãªRedux side effectãƒ­ã‚¸ãƒƒã‚¯ã«é©ã—ãŸmiddlewareã§ã™ã€‚</p>

<p>Redux Thunkã®æœ‰ç”¨æ€§ã«é–¢ã™ã‚‹è©³ã—ã„å†…å®¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã«ã‚ã‚Šã¾ã™ã€‚</p>

<ul>
  <li>
    <p><strong>Stack Overflow: Dispatching Redux Actions with a Timeout</strong><br />
http://stackoverflow.com/questions/35411423/how-to-dispatch-a-redux-action-with-a-timeout/35415559#35415559<br />
Dan AbramovãŒæ®µéšçš„ã«æ”¹å–„éç¨‹(inline async calls, async action creators, thunk middleware)ã‚’èª¬æ˜ã—ãªãŒã‚‰Reduxã§ã®éåŒæœŸå‡¦ç†ã®åŸºæœ¬ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚</p>
  </li>
  <li>
    <p><strong>Stack Overflow: Why do we need middleware for async flow in Redux?</strong><br />
http://stackoverflow.com/questions/34570758/why-do-we-need-middleware-for-async-flow-in-redux/34599594#34599594<br />
Dan AbramovãŒThunkã¨éåŒæœŸmiddlewareã‚’ä½¿ã†ç†ç”±ã¨Thunkã‚’ä½¿ã£ãŸä¾¿åˆ©ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚</p>
  </li>
  <li>
    <p><strong>What the heck is a â€œthunkâ€?</strong><br />
https://daveceddia.com/what-is-a-thunk/<br />
â€œthunkâ€ã®ä¸€èˆ¬çš„ãªæ„å‘³ã¨ãã‚Œã®Reduxã‚’ä½¿ã£ãŸå…·ä½“çš„ãªèª¬æ˜</p>
  </li>
  <li>
    <p><strong>Thunks in Redux: The Basics</strong><br />
https://medium.com/fullstack-academy/thunks-in-redux-the-basics-85e538a3fe60<br />
thunkã¨ã¯ä½•ã‹ã€ä½•ã‚’è§£æ±ºã™ã‚‹ã®ã‹ã€ãã®ä½¿ã„æ–¹ã®è©³è§£</p>
  </li>
</ul>

<p><strong><a href="https://redux.js.org/faq/actions#what-async-middleware-should-i-use-how-do-you-decide-between-thunks-sagas-observables-or-something-else">Redux FAQã®éåŒæœŸmiddlewareã®é¸æŠ</a></strong> ã‚’èª­ã‚€ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</p>

<p>ã“ã®Redux Thunk middlewareã¯Reduxã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç§ãŸã¡ãŒæä¾›ã—ã¦ã„ã‚‹ <strong><a href="https://github.com/reduxjs/redux-toolkit"><code class="language-plaintext highlighter-rouge">@reduxjs/toolkit</code></a></strong> ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚</p>

<h2 id="react-thunkã‚’ä½¿ã†ç†ç”±">React Thunkã‚’ä½¿ã†ç†ç”±</h2>

<p>Redux Thunk <a href="https://redux.js.org/advanced/middleware">middleware</a>ã‚’ä½¿ã†ã¨ã€actionã®ä»£ã‚ã‚Šã«é–¢æ•°ã‚’è¿”ã™action creatorã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚React Thunkã‚’ä½¿ã†ã¨actionãŒdispatchã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’é…ã‚‰ã›ãŸã‚Šã€æ¡ä»¶ã«å¿œã˜ã¦dispatchã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚action creatorã®å†…å´ã®é–¢æ•°ã¯storeã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹<code class="language-plaintext highlighter-rouge">dispatch</code>ã¨<code class="language-plaintext highlighter-rouge">getState</code>ã‚’å¼•æ•°ã¨ã—ã¦å—ã‘å–ã‚Šã¾ã™ã€‚</p>

<p>éåŒæœŸã§dispatchã‚’è¡Œã†é–¢æ•°ã‚’è¿”ã™action creator</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">INCREMENT_COUNTER</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">INCREMENT_COUNTER</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nx">INCREMENT_COUNTER</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">incrementAsync</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// `dispatch`ã§sync actionã¨async actionã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">increment</span><span class="p">());</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ¡ä»¶ã«å¿œã˜ã¦dispatchã™ã‚‹é–¢æ•°ã‚’è¿”ã™action creator</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">incrementIfOdd</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">counter</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">counter</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">dispatch</span><span class="p">(</span><span class="nx">increment</span><span class="p">());</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="thunkã£ã¦ä½•">thunkã£ã¦ä½•ï¼Ÿ</h2>

<p><a href="https://en.wikipedia.org/wiki/Thunk">thunk</a>ã¯è©•ä¾¡ã‚’é…å»¶ã•ã›ã‚‹ãŸã‚ã«å¼ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹é–¢æ•°ã§ã™ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1 + 2ã®è¨ˆç®—ã¯ã™ãã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</span>
<span class="c1">// x === 3</span>
<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// 1 + 2ã®è¨ˆç®—ã¯é…å»¶ã—ã¾ã™ã€‚</span>
<span class="c1">// ã‚ã¨ã§fooã‚’å‘¼ã³å‡ºã—ãŸæ™‚ã«</span>
<span class="c1">// fooãŒthunkã§ã™ã€‚</span>
<span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div>

<p>ã“ã®ç”¨èªã®<a href="https://en.wikipedia.org/wiki/Thunk#cite_note-1">èªæº</a>ã¯â€thinkâ€ã®éå»å½¢ã®ãŠã©ã‘ãŸè¡¨ç¾ã§ã™ã€‚</p>

<h2 id="ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>redux-thunk
</code></pre></div></div>

<p>Redux Thunkã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã«<a href="https://redux.js.org/api/applymiddleware"><code class="language-plaintext highlighter-rouge">applyMiddleware()</code></a>ã‚’ä½¿ã„ã¾ã™ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">thunk</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux-thunk</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">rootReducer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./reducers/index</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// ã“ã®APIã¯redux@&gt;=3.1.0ã§ä½¿ãˆã¾ã™ã€‚</span>
<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">,</span> <span class="nx">applyMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">));</span>
</code></pre></div></div>

<h2 id="éåŒæœŸã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ•ãƒ­ãƒ¼ã®æ§‹ç¯‰">éåŒæœŸã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ•ãƒ­ãƒ¼ã®æ§‹ç¯‰</h2>

<p>thunkå½¢å¼ã®action creatorã®å†…å´ã®é–¢æ•°ã§ã€ãã®å¼•æ•°ã§ã‚ã‚‹<code class="language-plaintext highlighter-rouge">dispatch</code>ã®æˆ»ã‚Šå€¤ã‚’æˆ»ã‚Šå€¤ã«ã™ã‚‹ã¨ã—ã¾ã™ã€‚ã“ã†ã™ã‚‹ã¨thunkå½¢å¼ã®action creatorå†…ã§åˆ¥ã®thunkå½¢å¼ã®action creatorã‚’dispatchã—ã¦ã€ãã‚Œã®æˆ»ã‚Šå€¤ã®Promiseã®å®Œäº†ã‚’å¾…ã¤ã‚ˆã†ãªéåŒæœŸã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">thunk</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">redux-thunk</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">rootReducer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./reducers</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// ã“ã®APIã¯redux@&gt;=3.1.0ã§ä½¿ãˆã¾ã™ã€‚</span>
<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">rootReducer</span><span class="p">,</span> <span class="nx">applyMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">));</span>

<span class="kd">function</span> <span class="nx">fetchSecretSauce</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://www.google.com/search?q=secret+sauce</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ã“ã‚Œã‚‰ã¯æ™®æ®µä½¿ã£ã¦ã„ã‚‹æ™®é€šã®action creatorã§ã™ã€‚</span>
<span class="c1">// ã“ã‚Œã‚‰ãŒè¿”ã™actionã¯middlewareãªã—ã§dispatchã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>
<span class="c1">// ãã®actionã¯å˜ã«â€œfactsâ€ã‚’è¡¨ã—ã¦ã„ã‚‹ã®ã¿ã§ã‚ã‚Šã€â€œasync flowâ€ã‚’è¡¨ã—ã¦ã„ã¾ã›ã‚“ã€‚</span>

<span class="kd">function</span> <span class="nx">makeASandwich</span><span class="p">(</span><span class="nx">forPerson</span><span class="p">,</span> <span class="nx">secretSauce</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">MAKE_SANDWICH</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">forPerson</span><span class="p">,</span>
    <span class="nx">secretSauce</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">apologize</span><span class="p">(</span><span class="nx">fromPerson</span><span class="p">,</span> <span class="nx">toPerson</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">APOLOGIZE</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">fromPerson</span><span class="p">,</span>
    <span class="nx">toPerson</span><span class="p">,</span>
    <span class="nx">error</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">withdrawMoney</span><span class="p">(</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">WITHDRAW</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">amount</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// middlewareãªã—ã§ã‚‚ã€actionã‚’dispatchã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>
<span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">withdrawMoney</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>

<span class="c1">// ã§ã¯ã€APIã®å‘¼ã³å‡ºã—ã‚„routerã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã®ã‚ˆã†ãªasync actionã‚’é–‹å§‹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã©ã†ã—ã¾ã™ã‹ï¼Ÿ</span>

<span class="c1">// ãã“ã§ã€thunkã®ç™»å ´ã§ã™ã€‚</span>
<span class="c1">// ã“ã“ã§ã„ã†thunkã¨ã¯éåŒæœŸå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«dispatchã•ã‚Œã‚‹é–¢æ•°ã§actionã‚’dispatchã™ã‚‹ã“ã¨ãŒã§ãã¦stateã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚</span>
<span class="c1">// ã“ã‚Œã¯thunkã‚’è¿”ã™action creatorã§ã™ã€‚</span>
<span class="kd">function</span> <span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="nx">forPerson</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// "thunk"å½¢å¼ã®é–¢æ•°ã‚’è¿”ã™ã“ã¨ã«ã‚ˆã£ã¦åˆ¶å¾¡ã‚’åˆ¥ã®ç‰©ã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>
  <span class="c1">// ã“ã®é–¢æ•°ãŒ`dispatch`ã«æ¸¡ã•ã‚Œã‚‹ã¨ã€React Thunk middlewareã¯é€šå¸¸ã¨ã¯åˆ¥ãƒ«ãƒ¼ãƒˆã®å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚</span>
  <span class="c1">// ãã®å‡¦ç†ã¯`dispatch`ã¨`getState`ã‚’å¼•æ•°ã¨ã—ã¦æ¸¡ã—ã¦å®Ÿè¡Œã™ã‚‹å‡¦ç†ã§ã™ã€‚</span>
  <span class="c1">// ã“ã‚Œã«ã‚ˆã£ã¦ã€thunké–¢æ•°å†…ã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ãŸã‚Šã€storeã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fetchSecretSauce</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span>
      <span class="p">(</span><span class="nx">sauce</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwich</span><span class="p">(</span><span class="nx">forPerson</span><span class="p">,</span> <span class="nx">sauce</span><span class="p">)),</span>
      <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">apologize</span><span class="p">(</span><span class="dl">'</span><span class="s1">The Sandwich Shop</span><span class="dl">'</span><span class="p">,</span> <span class="nx">forPerson</span><span class="p">,</span> <span class="nx">error</span><span class="p">)),</span>
    <span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// React Thunk middlewareã‚’ä½¿ã†ã¨ã€thunkå½¢å¼ã®async actionã‚’æ™®é€šã®actionã®ã‚ˆã†ã«dispatchã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>

<span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="dl">'</span><span class="s1">Me</span><span class="dl">'</span><span class="p">));</span>

<span class="c1">// dispatchã¯thunkã®æˆ»ã‚Šå€¤ã‚’è¿”ã™ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™</span>
<span class="c1">// ã ã‹ã‚‰ã€Promiseã‚’thunkãŒè¿”ã—ãŸå ´åˆã€ãã‚Œã®ãƒã‚§ã‚¤ãƒ³ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>

<span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="dl">'</span><span class="s1">My partner</span><span class="dl">'</span><span class="p">)).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Done!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// å®Ÿéš›ã«ã¯ã€ä»–ã®action creatorã‹ã‚‰ç”Ÿæˆã—ãŸæ™®é€šã®actionã‚„async actionã‚’dispatchã™ã‚‹action creatorã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚</span>
<span class="c1">// ãã—ã¦ã€Promiseã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>

<span class="kd">function</span> <span class="nx">makeSandwichesForEverybody</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">getState</span><span class="p">().</span><span class="nx">sandwiches</span><span class="p">.</span><span class="nx">isShopOpen</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Promiseã‚’è¿”ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã“ã‚Œã¯ä¾¿åˆ©ãªã‚„ã‚Šæ–¹ã§ã™ã€‚</span>
      <span class="c1">// ã“ã‚Œã§ã€å‘¼ã³å‡ºã—å…ƒã¯async actionã‚’dispatchã—ãŸçµæœã«å¯¾ã—ã¦å¸¸ã«`.then()`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>

      <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// ç´ ã®actionã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨thunkã‚’dispatchã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è¤‡æ•°ã®async actionã§1ã¤ã®ãƒ•ãƒ­ãƒ¼ã‚’æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>

    <span class="k">return</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="dl">'</span><span class="s1">My Grandma</span><span class="dl">'</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span>
        <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
          <span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="dl">'</span><span class="s1">Me</span><span class="dl">'</span><span class="p">)),</span>
          <span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="dl">'</span><span class="s1">My wife</span><span class="dl">'</span><span class="p">)),</span>
        <span class="p">]),</span>
      <span class="p">)</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="dl">'</span><span class="s1">Our kids</span><span class="dl">'</span><span class="p">)))</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span>
        <span class="nx">dispatch</span><span class="p">(</span>
          <span class="nx">getState</span><span class="p">().</span><span class="nx">myMoney</span> <span class="o">&gt;</span> <span class="mi">42</span>
            <span class="p">?</span> <span class="nx">withdrawMoney</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
            <span class="p">:</span> <span class="nx">apologize</span><span class="p">(</span><span class="dl">'</span><span class="s1">Me</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">The Sandwich Shop</span><span class="dl">'</span><span class="p">),</span>
        <span class="p">),</span>
      <span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹ã¾ã§å¾…ã£ã¦ã‹ã‚‰ã€åŒæœŸçš„ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ã“ã‚Œã¯ã¨ã¦ã‚‚ä¾¿åˆ©ã§ã™ã€‚</span>

<span class="nx">store</span>
  <span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeSandwichesForEverybody</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">ReactDOMServer</span><span class="p">.</span><span class="nx">renderToString</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">MyApp</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="se">))</span><span class="err">,
</span>  <span class="p">);</span>

<span class="c1">// propsãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã¯å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰thunkå½¢å¼ã®async actionã‚’dispatchã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react-redux</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">SandwichShop</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">forPerson</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="nx">componentDidUpdate</span><span class="p">(</span><span class="nx">prevProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prevProps</span><span class="p">.</span><span class="nx">forPerson</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">forPerson</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">makeASandwichWithSecretSauce</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">forPerson</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">sandwiches</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">mustard</span><span class="dl">'</span><span class="p">)}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span><span class="err">;
</span>  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">((</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">sandwiches</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">sandwiches</span><span class="p">,</span>
<span class="p">}))(</span><span class="nx">SandwichShop</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã®æ³¨å…¥">ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã®æ³¨å…¥</h2>

<p>2.1.0ã‹ã‚‰ã€<code class="language-plaintext highlighter-rouge">withExtraArgument</code>é–¢æ•°ã‚’ä½¿ã†ã¨ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã®æ³¨å…¥ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span>
  <span class="nx">reducer</span><span class="p">,</span>
  <span class="nx">applyMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">.</span><span class="nx">withExtraArgument</span><span class="p">(</span><span class="nx">api</span><span class="p">)),</span>
<span class="p">);</span>

<span class="c1">// å¾Œã»ã©</span>
<span class="kd">function</span> <span class="nx">fetchUser</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">,</span> <span class="nx">api</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã®`api`ã¯ã€ã“ã“ã§ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¤‡æ•°ã®å€¤ã‚’æ¸¡ã—ãŸã„å ´åˆã¯ã€ãã‚Œã‚‰ã‚’1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ã¨ã‚ã¾ã™ã€‚ES2015ã®shorthand property namesã‚’ä½¿ã†ã¨ã‚ˆã‚Šç°¡æ½”ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://www.example.com/sandwiches/</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">whatever</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span>
  <span class="nx">reducer</span><span class="p">,</span>
  <span class="nx">applyMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">.</span><span class="nx">withExtraArgument</span><span class="p">({</span> <span class="nx">api</span><span class="p">,</span> <span class="nx">whatever</span> <span class="p">})),</span>
<span class="p">);</span>

<span class="c1">// å¾Œã»ã©</span>
<span class="kd">function</span> <span class="nx">fetchUser</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">,</span> <span class="p">{</span> <span class="nx">api</span><span class="p">,</span> <span class="nx">whatever</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã®`api`ã¨ãã®ä»–ã¯ã€ã“ã“ã§ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="license">License</h2>

<h3 id="japanese-part">Japanese part</h3>

<p>Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)</p>

<p>Copyright (c) 2021 38elements</p>

<h3 id="other">Other</h3>

<p>The MIT License (MIT)</p>

<p>Copyright (c) 2015-present Dan Abramov</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the â€œSoftwareâ€), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED â€œAS ISâ€, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
